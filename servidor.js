const express = require('express')
const mongoose = require('mongoose')
const config = require('./config/config')

const app = express()

//Parse application/x-www-form-urlencoded
app.use(express.urlencoded({ extended: false }))

//Parse application/json
app.use(express.json())

//Rutas
app.use(require('./routes/index'))

//Ruta orientativa con los credenciales de un administrador y un usuario
app.get('/', (req, res) => {
    res.json({
        title: '******Malware API******',
        emails: 'admin@gmail.com, esther@gmail.com',
        passwords: 'admiN4321, User1234'
    })
})

//Conexión a la base de datos
mongoose.connect(config.mongoURI, {
    useNewUrlParser: true,
    useUnifiedTopology: true,
    useCreateIndex: true,
    useFindAndModify: false
}, (err) => {
    if (err) throw err

    console.log('Conexión a la base de datos establecida')
})

//Conexión al servidor
app.listen(config.puerto, () => {
    console.log('Escuchando el puerto:', config.puerto)
})