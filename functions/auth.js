const config = require('../config/config')
const jwt = require('jsonwebtoken')

//Middleware para verificar el token
const verificarToken = (req, res, next) => {
    let token = req.get('token')

    jwt.verify(token, config.semillaToken, (err, decoded) => {
        if (err) { return res.status(401).json({ message: 'token no vÃ¡lido' }) }
        req.datosToken = decoded.datosToken
        next()
    })
}

//Middleware para verificar el rol Administrador
const verificarRolAdmin = (req, res, next) => {
    let datos = req.datosToken

    if (datos.rol === 'ADMINISTRADOR') {
        next()
    } else { return res.status(403).json({ message: 'acceso no autorizado' }) }
}

module.exports = {
    verificarToken,
    verificarRolAdmin
}