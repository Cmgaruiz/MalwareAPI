const fs = require('fs')

let listaCredenciales = []
let listaLog = []

//Carga la lista de credenciales
const cargarLCrendenciales = () => {
    try {
        listaCredenciales = require('../files/credenciales.json')
    } catch (err) {
        listaCredenciales = []
    }
}

//Guarda las nuevas credenciales
const guardarCredenciales = (credenciales) => {
    cargarLCrendenciales()

    listaCredenciales.push(credenciales)

    let datos = JSON.stringify(listaCredenciales)

    fs.writeFile('./files/credenciales.json', datos, (err) => {
        if (err) throw err
    })
}

//Busca los credenciales a través del email del usuario y devuelve la contraseña
const buscarCredenciales = (email) => {
    cargarLCrendenciales()

    let indice = listaCredenciales.findIndex(usuario => usuario.email === email)

    return listaCredenciales[indice]
}

//Carga la lista del log
const cargarListaLog = () => {
    try {
        listaLog = require('../files/log.json')
    } catch (err) {
        listaLog = []
    }
}

//Guarda un nuevo registro de autenticación
const guardarLog = (log) => {
    cargarListaLog()

    listaLog.push(log)

    let datos = JSON.stringify(listaLog)

    fs.writeFile('./files/log.json', datos, (err) => {
        if (err) throw err
    })
}

module.exports = {
    guardarCredenciales,
    buscarCredenciales,
    guardarLog
}